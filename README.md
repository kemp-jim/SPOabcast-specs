# Overview

This repo contains the mCRL2 specifications and the properties related to my masters thesis called "Formal Modeling and Verification of Speculative Primary-Order Atomic Broadcast".

The specifications and formulas may differ slightly from those presented in the thesis, as certain comments were removed or the layout was changed. However, the specifications themselves are the same.

The used mcrl2 version was: `202407.1.f4a5210e7e` (nightly build).

I could not find this exact version, however on the mCRL2 GitHub the version `202407.1` can be downloaded which works.

# Properties

The properties are found in .mcf files in the `properties` directory.

The property names are the same as those from from the original SPOabcast paper (Vertical Atomic Broadcast and Passive Replication).

Certain properties correspond to well known atomic broadcast properties:

- 2a and 2b correspond to Uniform Integrity
- 3 corresponds to Uniform Total Order
- 5b corresponds to Validity
- 5cA, 5cB and 5cC correspond to Uniform Agreement


# Specifications


In each specification there is a section describing the parameters, which can be adjusted.

`MAX_EPOCH`, `MAX_BROADCASTS` and `CRASHABLE_REPLICAS` can be freely changed. However changing the initial leader of the system, changing the number of replicas or changing the number of intial members is more complicated.

## Changing the initial leader

To change the leader adjust `INITIAL_LEADER`, and also update the status at the bottom of the respective replica processes (ie. The new leader should have the `leader` status, followers should have the `follower` status, and replicas that are not members of the initial epoch should have the `fresh` status).

# Changing the number of replicas

Changing the number of replicas additionally requires adding/removing a value to the ProcessId_t sort at the top, and adding/removing another mcrl2 process at the bottom (and again setting the correct status for each replica).

# Changing the number of replicas in the initial epoch

Changing the initial replicas requires changing the `INITIAL_MEMBERS` parameters, and also requires changing the status of the new or removed replica.


# Scripts

Scripts (for Linux) were written to generate models and verify properties.

`createlts.sh` can be used to create an lts using 3 threads:

> sh createlts.sh specifications/spec.mcrl2 3

This creates a directory with the generated files, among others `reduced.lts` which is the reduced model.

By passing this lts file as the first argument and the property as the second argument, we can verify the property.

For example:

> sh verifyProperty.sh C_spec_2026-02-25--14-57/reduced.lts properties/3.Total_Order.mcf 


This prints:

```
Starting to load an lts from the file ../C_spec_2026-02-25--14-57/reduced.lts.
Solving parity game...
Extracting evidence...
true
Starting to save an lts to the file pbesfile.pbes.evidence.lts.
Saved witness in pbesfile.pbes.evidence.lts
```

The true indicates that the property holds.

The script also saves a witness under `pbesfile.pbes.evidence.lts` (or a counterexample in case the property does not hold).

The generated .lts files can be inspected with the ltsview tool. 

The tool lpsxsim can be used to simulate an .lps file (Generated by createlts.sh).